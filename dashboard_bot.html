<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel do Bot - LiquidaÃ§Ã£o AutomÃ¡tica</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:sans-serif;background:#0f172a;color:#f1f5f9;padding:20px}
.container{max-width:1600px;margin:0 auto}
header{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #6366f1}
h1{font-size:2rem;color:#6366f1;margin-bottom:10px}
.status{display:flex;gap:20px;justify-content:center;margin-top:15px;flex-wrap:wrap}
.status-item{background:#1e293b;padding:8px 16px;border-radius:6px;border:1px solid #334155}
.status-item.active{background:#10b981;border-color:#10b981}
.status-item.inactive{background:#ef4444;border-color:#ef4444}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:30px}
.stat{background:#1e293b;padding:20px;border-radius:8px;text-align:center;border:1px solid #334155}
.stat-value{font-size:2rem;color:#6366f1;font-weight:700}
.stat-label{color:#94a3b8;font-size:0.9rem;margin-top:5px}
.tabs{display:flex;gap:10px;margin-bottom:20px;border-bottom:2px solid #334155}
.tab{background:transparent;color:#94a3b8;border:none;padding:12px 24px;cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-2px}
.tab.active{color:#6366f1;border-bottom-color:#6366f1}
.tab:hover{color:#f1f5f9}
.tab-content{display:none}
.tab-content.active{display:block}
table{width:100%;border-collapse:collapse;background:#1e293b;border-radius:8px;overflow:hidden}
thead{background:#334155}
th{padding:12px;text-align:left;color:#f1f5f9;font-weight:600;font-size:0.9rem}
td{padding:12px;border-top:1px solid #334155;color:#94a3b8;font-size:0.9rem}
tr:hover{background:#334155}
.status-badge{display:inline-block;padding:4px 12px;border-radius:12px;font-size:0.8rem;font-weight:600}
.status-pendente{background:#f59e0b;color:#1e293b}
.status-ganhou{background:#10b981;color:white}
.status-perdeu{background:#ef4444;color:white}
.valor{color:#10b981;font-weight:600}
.valor-zero{color:#94a3b8}
.empty{text-align:center;padding:40px;color:#94a3b8}
.btn-refresh{background:#6366f1;color:white;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;margin-bottom:20px}
.btn-refresh:hover{background:#4f46e5}
</style>
</head>
<body>
<div class="container">
<header>
<h1>ðŸ¤– Bot de LiquidaÃ§Ã£o AutomÃ¡tica</h1>
<div class="status">
<span class="status-item" id="status-bot">Bot: <span id="bot-status-text">Verificando...</span></span>
<span class="status-item" id="status-monitor">Monitor: <span id="monitor-status-text">Verificando...</span></span>
</div>
</header>

<div class="stats">
<div class="stat">
<div class="stat-value" id="total-apostas">0</div>
<div class="stat-label">Total de Apostas</div>
</div>
<div class="stat">
<div class="stat-value" id="liquidacoes-hoje">0</div>
<div class="stat-label">LiquidaÃ§Ãµes Hoje</div>
</div>
<div class="stat">
<div class="stat-value" id="valor-liquidado">R$ 0,00</div>
<div class="stat-label">Valor Liquidado</div>
</div>
</div>

<div class="tabs">
<button class="tab active" onclick="mostrarTab('apostas')">ðŸ“‹ Apostas</button>
<button class="tab" onclick="mostrarTab('liquidacoes')">ðŸ’° LiquidaÃ§Ãµes</button>
</div>

<div id="tab-apostas" class="tab-content active">
<button class="btn-refresh" onclick="atualizarDashboard()">ðŸ”„ Atualizar</button>
<table>
<thead>
<tr>
<th>ID</th>
<th>ID Externo</th>
<th>UsuÃ¡rio</th>
<th>NÃºmero</th>
<th>Animal</th>
<th>Loteria</th>
<th>HorÃ¡rio</th>
<th>Valor</th>
<th>Status</th>
<th>Data</th>
</tr>
</thead>
<tbody id="tbody-apostas">
<tr><td colspan="10" class="empty">Carregando...</td></tr>
</tbody>
</table>
</div>

<div id="tab-liquidacoes" class="tab-content">
<button class="btn-refresh" onclick="atualizarDashboard()">ðŸ”„ Atualizar</button>
<table>
<thead>
<tr>
<th>ID Aposta</th>
<th>ID Externo</th>
<th>Status</th>
<th>Valor Ganho</th>
<th>Data</th>
</tr>
</thead>
<tbody id="tbody-liquidacoes">
<tr><td colspan="5" class="empty">Carregando...</td></tr>
</tbody>
</table>
</div>
</div>

<script>
function mostrarTab(tab){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
event.target.classList.add('active');
document.getElementById(`tab-${tab}`).classList.add('active');
}

async function atualizarDashboard(){
await Promise.all([
atualizarStatus(),
atualizarEstatisticas(),
atualizarApostas(),
atualizarLiquidacoes()
]);
}

async function atualizarStatus(){
try{
const r=await fetch('/api/status');
const d=await r.json();
document.getElementById('bot-status-text').textContent=d.bot_ativo?'Ativo':'Inativo';
document.getElementById('monitor-status-text').textContent=d.monitor_rodando?'Ativo':'Inativo';
document.getElementById('status-bot').classList.toggle('active',d.bot_ativo);
document.getElementById('status-bot').classList.toggle('inactive',!d.bot_ativo);
document.getElementById('status-monitor').classList.toggle('active',d.monitor_rodando);
document.getElementById('status-monitor').classList.toggle('inactive',!d.monitor_rodando);
}catch(e){console.error('Erro ao atualizar status:',e)}
}

async function atualizarEstatisticas(){
try{
const r=await fetch('/api/stats');
const d=await r.json();
document.getElementById('total-apostas').textContent=d.total_apostas||0;
document.getElementById('liquidacoes-hoje').textContent=d.liquidacoes_hoje||0;
const valor=d.valor_liquidado||0;
document.getElementById('valor-liquidado').textContent=`R$ ${valor.toFixed(2).replace('.',',')}`;
}catch(e){console.error('Erro ao atualizar estatÃ­sticas:',e)}
}

async function atualizarApostas(){
try{
const r=await fetch('/api/apostas/todas');
const d=await r.json();
const tbody=document.getElementById('tbody-apostas');
if(!d.apostas||d.apostas.length===0){
tbody.innerHTML='<tr><td colspan="10" class="empty">Nenhuma aposta encontrada</td></tr>';
return;
}
tbody.innerHTML=d.apostas.map(a=>{
const data=new Date(a.data_aposta);
const dataStr=data.toLocaleString('pt-BR',{timeZone:'America/Sao_Paulo'});
const statusClass=a.status==='pendente'?'status-pendente':a.status==='ganhou'?'status-ganhou':'status-perdeu';
return `<tr>
<td>${a.id}</td>
<td>${a.aposta_id_externo||'-'}</td>
<td>${a.usuario_id}</td>
<td>${a.numero}</td>
<td>${a.animal}</td>
<td>${a.loteria}</td>
<td>${a.horario}</td>
<td>R$ ${a.valor.toFixed(2).replace('.',',')}</td>
<td><span class="status-badge ${statusClass}">${a.status}</span></td>
<td>${dataStr}</td>
</tr>`;
}).join('');
}catch(e){
console.error('Erro ao atualizar apostas:',e);
document.getElementById('tbody-apostas').innerHTML='<tr><td colspan="10" class="empty">Erro ao carregar apostas</td></tr>';
}
}

async function atualizarLiquidacoes(){
try{
const r=await fetch('/api/liquidacoes/todas');
const d=await r.json();
const tbody=document.getElementById('tbody-liquidacoes');
if(!d.liquidacoes||d.liquidacoes.length===0){
tbody.innerHTML='<tr><td colspan="5" class="empty">Nenhuma liquidaÃ§Ã£o encontrada</td></tr>';
return;
}
tbody.innerHTML=d.liquidacoes.map(l=>{
const data=new Date(l.data_liquidacao);
const dataStr=data.toLocaleString('pt-BR',{timeZone:'America/Sao_Paulo'});
const statusClass=l.status==='ganhou'?'status-ganhou':'status-perdeu';
const valorClass=l.valor_ganho>0?'valor':'valor-zero';
return `<tr>
<td>${l.aposta_id}</td>
<td>${l.aposta_id_externo||'-'}</td>
<td><span class="status-badge ${statusClass}">${l.status}</span></td>
<td class="${valorClass}">R$ ${l.valor_ganho.toFixed(2).replace('.',',')}</td>
<td>${dataStr}</td>
</tr>`;
}).join('');
}catch(e){
console.error('Erro ao atualizar liquidaÃ§Ãµes:',e);
document.getElementById('tbody-liquidacoes').innerHTML='<tr><td colspan="5" class="empty">Erro ao carregar liquidaÃ§Ãµes</td></tr>';
}
}

// Atualizar a cada 5 segundos
setInterval(atualizarDashboard,5000);
atualizarDashboard();
</script>
</body>
</html>
